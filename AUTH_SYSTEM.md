# üîê –°–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ SUPERAPP

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞ —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –∏ –ø—Ä–æ–≤–µ—Ä–∫–æ–π 4-–∑–Ω–∞—á–Ω—ã—Ö –∫–æ–¥–æ–≤. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç –∫–æ–¥ –≤ Telegram –∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –µ–≥–æ –¥–ª—è –≤—Ö–æ–¥–∞ –≤ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã:

1. **Telegram Bot** (`telegram.js`) - –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–æ–¥—ã –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
2. **Auth API** (`auth.js`) - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–¥—ã –∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–µ—Å—Å–∏—è–º–∏
3. **Database** (`db.js`) - —Ö—Ä–∞–Ω–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö
4. **Express Routes** (`server/routes.ts`) - –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç —Å–∏—Å—Ç–µ–º—É –≤ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä

## üîÑ –ü—Ä–æ—Ü–µ—Å—Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–¥–∞
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí /auth –≤ Telegram ‚Üí –ë–æ—Ç –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–æ–¥ ‚Üí –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–¥
```

### 2. –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –í–≤–æ–¥–∏—Ç username + –∫–æ–¥ ‚Üí API –ø—Ä–æ–≤–µ—Ä—è–µ—Ç ‚Üí –°–æ–∑–¥–∞–µ—Ç —Å–µ—Å—Å–∏—é
```

## üéØ API Endpoints

### POST /api/auth/verify-code
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–¥ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ —Å–æ–∑–¥–∞–µ—Ç —Å–µ—Å—Å–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**Request:**
```json
{
  "username": "username",
  "code": "1234"
}
```

**Response (success):**
```json
{
  "success": true,
  "message": "–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞",
  "user": {
    "id": 1,
    "username": "username",
    "role": "admin",
    "phone_number": "+79267166906"
  }
}
```

**Response (error):**
```json
{
  "success": false,
  "message": "–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥"
}
```

### GET /api/auth/status
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**Response:**
```json
{
  "success": true,
  "authenticated": true,
  "user": {
    "id": 1,
    "username": "username",
    "role": "admin"
  }
}
```

### POST /api/auth/logout
–í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã (—É–Ω–∏—á—Ç–æ–∂–∞–µ—Ç —Å–µ—Å—Å–∏—é).

**Response:**
```json
{
  "success": true,
  "message": "–í—ã—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ"
}
```

### GET /api/auth/user
–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ.

**Response:**
```json
{
  "success": true,
  "user": {
    "id": 1,
    "username": "username",
    "role": "admin"
  }
}
```

## ü§ñ Telegram Bot Commands

### /auth
–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç 4-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥ –¥–ª—è –≤—Ö–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º—É.

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å username –≤ Telegram
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ —Å–∏—Å—Ç–µ–º–µ

**–û—Ç–≤–µ—Ç –±–æ—Ç–∞:**
```
üîê –ö–æ–¥ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: @username
üéØ –†–æ–ª—å: admin

üî¢ –í–∞—à –∫–æ–¥: 1234

‚è∞ –î–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω: 10 –º–∏–Ω—É—Ç
üåê –°–∞–π—Ç: http://localhost:5173

üìù –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ —Å–∞–π—Ç
2. –í–≤–µ–¥–∏—Ç–µ username: @username
3. –í–≤–µ–¥–∏—Ç–µ –∫–æ–¥: 1234
4. –ù–∞–∂–º–∏—Ç–µ "–í–æ–π—Ç–∏"

‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ: –ù–µ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ –∫–æ–¥ —Ç—Ä–µ—Ç—å–∏–º –ª–∏—Ü–∞–º!
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ `env.example`:

```env
TELEGRAM_BOT_TOKEN=your_telegram_bot_token_here
SESSION_SECRET=your_session_secret_here
DATABASE_URL=sqlite:./auth.db
NODE_ENV=development
PORT=5000
VITE_API_URL=http://127.0.0.1:5000
```

### 2. –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã
```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
npm run dev

# –ò–ª–∏ –ø–æ –æ—Ç–¥–µ–ª—å–Ω–æ—Å—Ç–∏:
npm run bot      # Telegram –±–æ—Ç
npm run server   # Express —Å–µ—Ä–≤–µ—Ä
npm run client   # Vite –∫–ª–∏–µ–Ω—Ç
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ö–æ–¥—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:
- **–î–ª–∏–Ω–∞:** 4 —Ü–∏—Ñ—Ä—ã (1000-9999)
- **–í—Ä–µ–º—è –∂–∏–∑–Ω–∏:** 10 –º–∏–Ω—É—Ç
- **–û–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ:** —É–¥–∞–ª—è—é—Ç—Å—è –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- **–ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞:** —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∫–æ–¥—ã —É–¥–∞–ª—è—é—Ç—Å—è –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç

### –°–µ—Å—Å–∏–∏:
- **–í—Ä–µ–º—è –∂–∏–∑–Ω–∏:** 24 —á–∞—Å–∞
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** httpOnly cookies
- **–°–µ–∫—Ä–µ—Ç:** –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ SESSION_SECRET

### –ó–∞—â–∏—Ç–∞ –æ—Ç –∞—Ç–∞–∫:
- SQL-–∏–Ω—ä–µ–∫—Ü–∏–∏: prepared statements
- XSS: httpOnly cookies
- CSRF: –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–π
- –ë—Ä—É—Ç—Ñ–æ—Ä—Å: –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ–ø—ã—Ç–æ–∫ (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å)

## üìä –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ users:
```sql
CREATE TABLE users (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  username TEXT UNIQUE,
  phone_number TEXT,
  role TEXT,
  telegram_chat_id TEXT,
  auth_code TEXT,
  auth_expires TEXT
);
```

### –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
- **admin** - –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä (–ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø)
- **hostess** - –•–æ—Å—Ç–µ—Å
- **dancer** - –¢–∞–Ω—Ü–æ–≤—â–∏—Ü–∞
- **promoter** - –ü—Ä–æ–º–æ—É—Ç–µ—Ä
- **unknown** - –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Ä–æ–ª—å

## üöÄ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ React:
```javascript
// –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–¥–∞
const getAuthCode = async (username) => {
  // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –ø–æ–ª—É—á–∏—Ç—å –∫–æ–¥ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞
  console.log(`–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /auth –≤ Telegram –±–æ—Ç–µ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–¥–∞`);
};

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞
const verifyCode = async (username, code) => {
  const response = await fetch('/api/auth/verify-code', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ username, code })
  });
  
  const result = await response.json();
  return result;
};

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
const checkAuthStatus = async () => {
  const response = await fetch('/api/auth/status');
  const result = await response.json();
  return result;
};

// –í—ã—Ö–æ–¥
const logout = async () => {
  await fetch('/api/auth/logout', { method: 'POST' });
};
```

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –õ–æ–≥–∏ –±–æ—Ç–∞:
```
üîê –ö–æ–¥ 1234 –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é username (123456789)
‚úÖ –£—Å–ø–µ—à–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è username
üßπ –£–¥–∞–ª–µ–Ω —É—Å—Ç–∞—Ä–µ–≤—à–∏–π –∫–æ–¥ –¥–ª—è username
```

### –õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞:
```
POST /api/auth/verify-code 200 in 45ms :: {"success":true,"message":"–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞"}
GET /api/auth/status 200 in 12ms :: {"success":true,"authenticated":true}
```

## üîÑ –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ä–æ–ª–µ–π:
1. –û–±–Ω–æ–≤–∏—Ç–µ enum —Ä–æ–ª–µ–π –≤ –∫–æ–¥–µ
2. –î–æ–±–∞–≤—å—Ç–µ –ª–æ–≥–∏–∫—É –¥–æ—Å—Ç—É–ø–∞
3. –û–±–Ω–æ–≤–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:
1. –î–æ–±–∞–≤—å—Ç–µ –ø–æ–ª–µ `two_factor_enabled` –≤ –ë–î
2. –†–µ–∞–ª–∏–∑—É–π—Ç–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é TOTP –∫–æ–¥–æ–≤
3. –û–±–Ω–æ–≤–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ø–æ–ø—ã—Ç–æ–∫:
1. –î–æ–±–∞–≤—å—Ç–µ —Å—á–µ—Ç—á–∏–∫ –ø–æ–ø—ã—Ç–æ–∫ –≤ Map
2. –†–µ–∞–ª–∏–∑—É–π—Ç–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –ø–æ—Å–ª–µ N –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
3. –î–æ–±–∞–≤—å—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω—É—é –±–ª–æ–∫–∏—Ä–æ–≤–∫—É

---

**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–î–∞—Ç–∞:** 2025-01-25  
**–ê–≤—Ç–æ—Ä:** SUPERAPP Team 